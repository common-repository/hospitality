/*! hospitality 2016-11-28 */
function initAdminMap(){var a=new google.maps.Geocoder;jQuery(".hsp-geocode-button").click(function(b){b.preventDefault();var c=jQuery("#hsp-settings-street-1").val(),d=jQuery("#hsp-settings-city").val(),e=jQuery("#hsp-settings-state").val(),f=jQuery("#hsp-settings-postal-code").val(),g=(jQuery("#hsp-settings-country").val(),c+", "+d+", "+e+" "+f);a.geocode({address:g},function(a,b){if(b==google.maps.GeocoderStatus.OK){var c=a[0].geometry.location.lat(),d=a[0].geometry.location.lng();c=parseFloat(c.toFixed(HSP_DECIMAL_PLACES)),d=parseFloat(d.toFixed(HSP_DECIMAL_PLACES)),jQuery("#hsp-settings-lat").val(c),jQuery("#hsp-settings-lng").val(d),jQuery("#hsp-settings-geocode-message").html("<p>"+hsp_admin_objectl10n.geocode_ok+"</p>")}else jQuery("#hsp-settings-geocode-message").html("<p>"+hsp_admin_objectl10n.geocode_error+b+"</p>")})})}jQuery(document).ready(function(a){function b(){a(".gst_room_location_unit_number_input").focusout(function(){var b=a(this).val(),c=a(this).siblings(".gst_room_location_location_id_select").val(),d=a(this).siblings('[name^="meta_room_locations-id"]').val();a(this).data("validation-pending","true"),l(d,c,b)})}function c(){a.ajax({url:hsp_admin_objectl10n.wpsiteinfo.site_url+"/wp-admin/admin-ajax.php",data:{action:"hospitality_ajax",fn:"get_post_edit_options"},dataType:"JSON",success:function(b){null!=b.errorData&&"true"==b.errorData&&q(b);var c=b;a(".gst_countable").simplyCountable({counter:"#gst_counter",countType:"characters",maxCount:c.room_excerpt_max_char_count,strictMax:!1,overClass:"gst-excerpt-over",countDirection:"down"})},error:function(a){console.log(a)}})}function d(b){null!=b&&""!=b?a.ajax({url:hsp_admin_objectl10n.wpsiteinfo.site_url+"/wp-admin/admin-ajax.php",data:{action:"hospitality_ajax",fn:"get_amenity_set_list",postID:b},dataType:"JSON",success:function(a){null!=a.errorData&&"true"==a.errorData&&q(a),e(a)},error:function(a){console.log(a)}}):e("")}function e(b){var c=".adm_amenity_set_list",d="#amenity_list_panel";if(a(c).empty(),""==b)return void a(c).append("<p>"+hsp_admin_objectl10n.note_no_amnenity_set_selected+"</p>");a(c).append('<div id="'+d+'">'),a(c).append("<ul>");for(i in b)a(c).append("<li>"+b[i]+"</li>");a(c).append("</ul>"),a(c).append("</div>")}function f(b){null!=b&&""!=b?a.ajax({url:hsp_admin_objectl10n.wpsiteinfo.site_url+"/wp-admin/admin-ajax.php",data:{action:"hospitality_ajax",fn:"get_pricing_model",postID:b},dataType:"JSON",success:function(a){null!=a.errorData&&"true"==a.errorData&&q(a),g(a)},error:function(a){alert(hsp_admin_objectl10n.get_pricing_model_error+a.responseText.substring(0,500)),console.log(a)}}):g("")}function g(b){var c=".adm_pricing_model",d="pricing_model_panel";if(a(c).empty(),""==b)return void a(c).append("<p>"+hsp_admin_objectl10n.note_no_pricing_model_selected+"</p>");var e='<div id="'+d+'">';e+='<ul id="pricing_model">';for(i in b)e+="<li><h3>"+b[i].title+"</h3>",""!=b[i].dateRange1&&(e+="<h4>"+b[i].dateRange1+"</h4>"),priceStr="<table><tr>",priceStr+="<th>"+hsp_admin_objectl10n.sunday+"</th>",priceStr+="<th>"+hsp_admin_objectl10n.monday+"</th>",priceStr+="<th>"+hsp_admin_objectl10n.tuesday+"</th>",priceStr+="<th>"+hsp_admin_objectl10n.wednesday+"</th>",priceStr+="<th>"+hsp_admin_objectl10n.thursday+"</th>",priceStr+="<th>"+hsp_admin_objectl10n.friday+"</th>",priceStr+="<th>"+hsp_admin_objectl10n.saturday+"</th>",priceStr+="</tr><tr>",priceStr+="<td>"+b[i].priceByDOW.sunday+"</td>",priceStr+="<td>"+b[i].priceByDOW.monday+"</td>",priceStr+="<td>"+b[i].priceByDOW.tuesday+"</td>",priceStr+="<td>"+b[i].priceByDOW.wednesday+"</td>",priceStr+="<td>"+b[i].priceByDOW.thursday+"</td>",priceStr+="<td>"+b[i].priceByDOW.friday+"</td>",priceStr+="<td>"+b[i].priceByDOW.saturday+"</td>",priceStr+="</tr>",priceStr+="</table>",e+='<div class="hsp_room_price">'+priceStr+"</div></li>";e+="</ul>",e+="</div>",a(c).append(e)}function h(){a.ajax({url:hsp_admin_objectl10n.wpsiteinfo.site_url+"/wp-admin/admin-ajax.php",data:{action:"hospitality_ajax",fn:"gen_demo_data"},dataType:"JSON",success:function(a){null!=a.errorData&&"true"==a.errorData&&q(a),alert("Gen Demo Data Success")},error:function(a){alert(hsp_admin_objectl10n.get_pricing_model_error+a.responseText.substring(0,500)),console.log(a)}})}function j(b,c){b.preventDefault(),c.siblings(".gst_image_url_target").addClass("gst-set-media-target"),c.siblings("a").children("img").addClass("gst-set-media-thumbnail-target"),s=wp.media.frames.meta_image_frame=wp.media({library:{type:"image"}}),s.on("select",function(){var b=s.state().get("selection").first().toJSON();a(".gst-set-media-target").val(b.url),a(".gst-set-media-target").removeClass("gst-set-media-target"),a(".gst-set-media-thumbnail-target").attr("src",b.url),a(".gst-set-media-thumbnail-target").removeClass("gst-set-media-thumbnail-target")}),s.open()}function k(b,c){confirm("Delete room location?")&&null!=b&&""!=b&&a.ajax({url:hsp_admin_objectl10n.wpsiteinfo.site_url+"/wp-admin/admin-ajax.php",data:{action:"hospitality_ajax",fn:"delete_room_location",postID:b},dataType:"JSON",success:function(b){null!=b.errorData&&"true"==b.errorData?r(".hsp-room-location-msg",b):a(c).remove()},error:function(a){console.log(a)}})}function l(b,c,d){a.ajax({url:hsp_admin_objectl10n.wpsiteinfo.site_url+"/wp-admin/admin-ajax.php",data:{action:"hospitality_ajax",fn:"validate_room_location",roomLocationID:b,locationID:c,roomNumber:d},dataType:"JSON",success:function(a){null!=a.errorData&&"true"==a.errorData?q(a):m(a)},error:function(a){console.log(a)}})}function m(b){return 1==b.isValid?void a(".gst_room_location_unit_number_input").each(function(b,c){"true"==a(this).data("validation-pending")&&(a(this).siblings(".hsp-unit-number-msg").html(""),a(this).data("validation-pending","false"))}):void a(".gst_room_location_unit_number_input").each(function(c,d){"true"==a(this).data("validation-pending")&&(a(this).siblings(".hsp-unit-number-msg").html(b.message),a(this).data("validation-pending","false"))})}function n(b,c){a("#meta_pricing_model_list").children().each(function(b,c){var d=a(c).html(),e="meta_pricing_model_list["+b+"]",f=d.replace(/meta_pricing_model_list\[[0-9]*\]/g,e);f='<li class="ui-state-default">'+f+"</li>",a(this).replaceWith(f)}),a(".gst_date_input").removeClass("hasDatepicker"),a(".gst_date_input").attr("id",""),a(".gst_date_input").datepicker({dateFormat:"M dd"}),a(".gst_pricing_input").on("change",function(){a(this).attr("value",a(this).val())}),a(".gst_date_input").change(function(){o()}),a("#meta_pricing_model_list .gst-sort-edit-delete").click(function(){a(this).parent().parent().remove(),n(b,a(this))})}function o(){var b=a(".gst_date_input");coveredRanges=new Array;for(var c="",d=0;d<b.length;d+=2)c=c+" "+b[d].value+" "+b[d+1].value,startStr=b[d].value,endStr=b[d+1].value,now=new Date,startDate=new Date(startStr+", "+now.getFullYear()),endDate=new Date(endStr+", "+now.getFullYear()),startLongTime=Date.UTC(now.getFullYear(),startDate.getMonth(),startDate.getDate()),endLongTime=Date.UTC(now.getFullYear(),endDate.getMonth(),endDate.getDate()),janOneLongTime=Date.UTC(now.getFullYear(),0,1),startDOY=(startLongTime-janOneLongTime)/864e5,endDOY=(endLongTime-janOneLongTime)/864e5,2==b.length&&(isNaN(startDOY)||isNaN(endDOY))&&(startDOY=0,endDOY=365),endDOY<startDOY?(range1={min:0,max:endDOY},range2={min:startDOY,max:365},coveredRanges.push(range1),coveredRanges.push(range2)):(range1={min:startDOY,max:endDOY},coveredRanges.push(range1));if(coveredRanges.sort(function(a,b){return a.min-b.min}),overlaps=new Array,gaps=new Array,1==coveredRanges.length)coveredRanges[0].min>0&&gaps.push({min:1,max:coveredRanges[0].min}),coveredRanges[0].max<364&&gaps.push({min:coveredRanges[0].max+2,max:365});else for(d=0;d<coveredRanges.length;d++)thisIdx=d,nextIdx=d+1==coveredRanges.length?0:d+1,0==nextIdx?(rangeCmp=coveredRanges[d].max-364,0==rangeCmp||1==rangeCmp||gaps.push({min:coveredRanges[d].max+2,max:365})):(rangeCmp=coveredRanges[nextIdx].min-coveredRanges[d].max,0==d&&(0==coveredRanges[d].min||gaps.push({min:1,max:coveredRanges[d].min})),1==rangeCmp||-364==rangeCmp||(0==rangeCmp?overlaps.push({min:coveredRanges[d].max+1,max:coveredRanges[d].max+1}):rangeCmp>1?gaps.push({min:coveredRanges[d].max+2,max:coveredRanges[nextIdx].min}):rangeCmp<0&&overlaps.push({min:coveredRanges[nextIdx].min+1,max:coveredRanges[d].max+1})));var e=hsp_admin_objectl10n.gaps_msg+" ";for(d=0;d<gaps.length;d++)min_lt=864e5*gaps[d].min+janOneLongTime,max_lt=864e5*gaps[d].max+janOneLongTime,minDate=new Date(min_lt),maxDate=new Date(max_lt),e+=p(minDate.getMonth())+" "+minDate.getDate()+"-",e+=p(maxDate.getMonth())+" "+maxDate.getDate()+"  ";var f=hsp_admin_objectl10n.overlaps_msg+" ";for(d=0;d<overlaps.length;d++)min_lt=864e5*overlaps[d].min+janOneLongTime,max_lt=864e5*overlaps[d].max+janOneLongTime,minDate=new Date(min_lt),maxDate=new Date(max_lt),f+=p(minDate.getMonth())+" "+minDate.getDate()+"-",f+=p(maxDate.getMonth())+" "+maxDate.getDate()+"  ";overlaps.length>0||gaps.length>0?a(".meta_pricing_model_list_feedback").html("<p>"+f+"</br>"+e+"</p>"):a(".meta_pricing_model_list_feedback").empty()}function p(a){switch(a){case 0:return hsp_admin_objectl10n.jan;case 1:return hsp_admin_objectl10n.feb;case 2:return hsp_admin_objectl10n.mar;case 3:return hsp_admin_objectl10n.apr;case 4:return hsp_admin_objectl10n.may;case 5:return hsp_admin_objectl10n.jun;case 6:return hsp_admin_objectl10n.jul;case 7:return hsp_admin_objectl10n.aug;case 8:return hsp_admin_objectl10n.sep;case 9:return hsp_admin_objectl10n.oct;case 10:return hsp_admin_objectl10n.nov;case 11:return hsp_admin_objectl10n.dec;default:console.log("Unexpected month number value"+a)}return hsp_admin_objectl10n.jan}function q(a){console.log(a)}function r(b,c){a(b).html(c.errorMessage)}a("#hsp-admin-notice-dismiss").click(function(){a("#hsp-admin-notice").remove(),a.ajax({url:hsp_admin_objectl10n.wpsiteinfo.site_url+"/wp-admin/admin-ajax.php",data:{action:"hospitality_ajax",fn:"dismiss_upgrade_message"},dataType:"JSON",success:function(a){null!=a.errorData&&"true"==a.errorData&&q(a);var b=a;0==b&&q("dismiss_upgrade_notice AJAX call returned false")},error:function(a){console.log(a)}})}),a("#hsp-setup-notice-dismiss").click(function(){a("#hsp-setup-notice").remove(),a.ajax({url:hsp_admin_objectl10n.wpsiteinfo.site_url+"/wp-admin/admin-ajax.php",data:{action:"hospitality_ajax",fn:"dismiss_setup_message"},dataType:"JSON",success:function(a){null!=a.errorData&&"true"==a.errorData&&q(a);var b=a;0==b&&q("dismiss_setup_notice AJAX call returned false")},error:function(a){console.log(a)}})}),a(".gst-sortable").sortable(),a(".gst-sortable").disableSelection(),c(),"pricing-models"==hsp_admin_objectl10n.current_post_type?(o(),a(".gst_date_input").datepicker({dateFormat:"M dd"})):a(".gst_date_input").datepicker(),"reservations"==hsp_admin_objectl10n.current_post_type&&a("#duration, #room_location_id, #start_time").change(function(){var b=a("#duration").val(),c=a("#room_location_id").val(),d=(a("#start_time").val(),new Date(a("#start_time").val())),e=new Date(d.toDateString()).getTime(),f=0;hsp_admin_objectl10n.checkInTime.endsWith("PM")&&(f=12);var g=hsp_admin_objectl10n.checkInTime.split(":"),h=parseInt(g[0]),i=g[1].split(" "),j=parseInt(i[0]);f+=h,f+=j/60,e+=36e5*f;var k=864e5*b,l={room_location_id:c,dateOfArrivalLong:e,lengthOfStayLong:k};a.ajax({url:hsp_admin_objectl10n.wpsiteinfo.site_url+"/wp-admin/admin-ajax.php",data:{action:"hospitality_ajax",fn:"get_room_location_availability",searchCriteria:JSON.stringify(l)},dataType:"JSON",success:function(b){null!=b.errorData&&"true"==b.errorData?q(b):0==b.is_available?(a("#gst-room-location-message").empty(),a("#gst-room-location-message").prepend('<span class="gst-admin-error-message">'+hsp_admin_objectl10n.reservation_conflict+" </span>")):a("#gst-room-location-message").empty()},error:function(a){console.log(a)}})}),a(".gst_time_input").timepicker({timeFormat:"h:i A"}),a(".gst_pricing_input").on("change",function(){a(this).attr("value",a(this).val())}),a("#meta_pricing_model_list").on("sortupdate",function(b,c){n(b,a(this))}),a(".gst-sort-edit-delete").click(function(b){a(this).hasClass("gst-room-location-delete")?k(a(this).data("rlid"),a(this).parent().parent()):a(this).parent().parent().remove()}),a("#meta_pricing_model_list .gst-sort-edit-delete").click(function(b){a(this).parent().parent().remove(),n(b,a(this))}),a("#post").submit(function(){}),a("#publish").click(function(b){a(".gst_room_location_unit_number_input").each(function(c,d){""==a(this).val()&&(alert("Room location unit numbers cannot be blank."),b.preventDefault(),a(this).focus())})}),a(".gst_date_input").change(function(){(hsp_hsp_admin_objectl10n.current_post_type="pricing-models")&&o()});var s;a(".gst-sort-edit-image-upload").click(function(b){j(b,a(this))}),a(".gst-sort-edit-image-add").click(function(b){var c=atob(a(this).siblings(".gst_clone_template").val());a(this).parent().parent().children().filter(".gst-sortable").append(c),a(this).parent().parent().children().filter(".gst-sortable").children().last().find(".gst-sort-edit-delete").click(function(){a(this).parent().parent().remove()}),a(this).parent().parent().children().filter(".gst-sortable").children().last().find(".gst-sort-edit-image-upload").click(function(){j(b,a(this))}),a(this).parent().parent().children().filter(".gst-sortable").children().last().find(".gst_clear_input_target").val(""),a(this).parent().parent().children().filter(".gst-sortable").children().last().find(".gst-sort-edit-image-upload").trigger("click")}),a(".gst-sort-edit-add").click(function(){var b=atob(a(this).siblings(".gst_clone_template").val());a(this).parent().parent().children().filter(".gst-sortable").append(b),a(this).parent().parent().children().filter(".gst-sortable").children().last().find("input").attr("value",""),a(this).parent().parent().children().filter(".gst-sortable").children().last().find(".gst-sort-edit-delete").click(function(){a(this).parent().parent().remove()})}),a(".gst-sort-edit-room-location-add").click(function(){var c=atob(a(this).siblings(".gst_clone_template").val());a(this).parent().parent().children().filter(".gst-sortable").append(c),a(this).parent().parent().children().filter(".gst-sortable").children().last().find("input").attr("value",""),a(this).parent().parent().children().filter(".gst-sortable").children().last().find(".gst-sort-edit-delete").click(function(){a(this).parent().parent().remove()}),b()}),a(".gst-sort-edit-pricing-add").click(function(b){var c=atob(a(this).siblings(".gst_clone_template").val());a(this).parent().parent().children().filter(".gst-sortable").append(c),a(this).parent().parent().children().filter(".gst-sortable").children().last().find("input").attr("value",""),n(b,a(this))}),a(".option-tree-setting-body").append('<a class="ot_setting_body_done">Done</a>'),d(a("#meta_room_amenity_select").val()),f(a("#meta_room_pricing_select").val()),a("#meta_room_amenity_select").change(function(){d(this.value)}),a("#meta_room_pricing_select").change(function(){f(this.value)}),a(".ot_setting_body_done").click(function(){a('.option-tree-setting-body[style="display: block;"]').css("display","none")}),a(".option-tree-list-item-add").click(function(){setTimeout(function(){a('.option-tree-setting-body[style="display: block;"]').append('<a class="ot_setting_body_done">Done</a>'),a('.option-tree-setting-body[style="display: block;"] .ot_setting_body_done').click(function(){a('.option-tree-setting-body[style="display: block;"]').css("display","none")})},500)}),a(".gst_room_location_unit_number_input").change(function(){}),b(),a("#gen-demo").click(function(){h()})});var HSP_DECIMAL_PLACES=7;